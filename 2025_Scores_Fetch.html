<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>2025 RSL Meet Scores</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f8f8f8;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #0156B3;
      font-size: 2em;
      margin-bottom: 10px;
    }

    .dropdown-container {
      position: sticky;
      top: 0;
      background-color: #f8f8f8;
      padding: 10px;
      text-align: center;
      z-index: 10;
      border-bottom: 1px solid #ccc;
      font-size: 0.7em;
    }

    .dropdown-box {
      display: inline-block;
      margin: 0 4px;
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 6px;
    }

    select {
      padding: 3px 6px;
      font-size: 0.7em;
      border-radius: 4px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.68em;
      margin-top: 10px;
    }

    th, td {
      padding: 6px 10px;
      border: 1px solid #ccc;
      text-align: left;
      vertical-align: top;
    }

    th {
      background-color: #e5f1ff;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    .winner {
      font-weight: bold;
      color: green;
    }

    .check {
      font-size: 1em;
      margin-left: 4px;
    }

    .meet-name {
      font-style: italic;
      color: #666;
    }
  </style>
</head>
<body>

<h1>2025 RSL Meet Scores</h1>

<div class="dropdown-container">
  <div class="dropdown-box">
    <label for="weekSelect">Week</label>
    <select id="weekSelect" onchange="loadWeekData(this.value)">
      <!-- Dynamically populated -->
    </select>
  </div>
  <div class="dropdown-box">
    <label for="divisionSelect">Division</label>
    <select id="divisionSelect" onchange="filterDivision()">
      <option value="all">All Divisions</option>
    </select>
  </div>
</div>

<table id="scoresTable">
  <thead>
    <tr>
      <th>Date</th>
      <th>Meet</th>
      <th>Score</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const weekFiles = [
    "2025scoresweek01.json",
    "2025scoresweek02.json",
    "2025scoresweek03.json",
    "2025scoresweek04.json"
    // Add more as needed
  ];

  const teamDivisionMap = {
    "Massad YMCA": "Battlefield",
    "Hampton Oaks": "Battlefield",
    "Woodlands": "Battlefield",
    "Fawn Lake": "Battlefield",
    "Spotswood": "Battlefield",
    "Curtis Park": "Battlefield",
    "Leeland Station": "Patriot",
    "Austin Ridge": "Patriot",
    "Lake of the Woods": "Patriot",
    "Lee's Hill": "Patriot",
    "Aquia Harbour": "Patriot",
    "Dahlgren": "Patriot",
    "Fox Point": "Patriot",
    "Fredericksburg CC": "American",
    "Ferry Farm": "American",
    "Chancellor": "American",
    "Hopyard": "American",
    "Caroline": "American",
    "Spotsy Y": "American",
    "Grafton": "National",
    "College Heights": "National",
    "Salem Fields": "National",
    "Lake Wilderness": "National",
    "Eden Estates": "National",
    "Idlewild": "National"
  };

  let allRows = [];

  function getDivision(team1, team2) {
    const d1 = teamDivisionMap[team1];
    const d2 = teamDivisionMap[team2];
    if (d1 && d2) {
      return d1 === d2 ? d1 : "Mixed";
    }
    return d1 || d2 || "Unknown";
  }

  function populateWeekDropdown() {
    const dropdown = document.getElementById("weekSelect");
    weekFiles.forEach((file, idx) => {
      const weekNum = idx + 1;
      const option = document.createElement("option");
      option.value = file;
      option.text = `Week #${weekNum}`;
      dropdown.appendChild(option);
    });
  }

  function populateDivisionDropdown(rows) {
    const divisions = [...new Set(rows.map(row => row.division))];
    const divisionSelect = document.getElementById("divisionSelect");
    divisionSelect.innerHTML = `<option value="all">All Divisions</option>`;
    divisions.forEach(div => {
      const opt = document.createElement("option");
      opt.value = div;
      opt.text = div;
      divisionSelect.appendChild(opt);
    });
  }

  function loadWeekData(file) {
    fetch(file)
      .then(res => res.json())
      .then(data => {
        const merged = new Map();

        data.values.forEach(row => {
          const [date, meetName, teamA, scoreA, teamB, scoreB] = row;
          const key = `${meetName}|${date}`;

          if (!merged.has(key)) {
            merged.set(key, {
              date,
              meetName,
              homeTeam: null,
              homeScore: null,
              awayTeam: null,
              awayScore: null
            });
          }

          const match = merged.get(key);

          // Assign teams and scores smartly
          if (scoreA != null && teamA) {
            if (!match.homeScore) {
              match.homeTeam = teamA;
              match.homeScore = scoreA;
            } else if (!match.awayScore && teamA !== match.homeTeam) {
              match.awayTeam = teamA;
              match.awayScore = scoreA;
            }
          }

          if (scoreB != null && teamB) {
            if (!match.awayScore && teamB !== match.homeTeam) {
              match.awayTeam = teamB;
              match.awayScore = scoreB;
            } else if (!match.homeScore && teamB !== match.awayTeam) {
              match.homeTeam = teamB;
              match.homeScore = scoreB;
            }
          }
        });

        allRows = Array.from(merged.values).map(m => {
          const division = getDivision(m.homeTeam, m.awayTeam);
          return {
            division,
            data: [
              m.date,
              m.meetName,
              m.homeTeam,
              m.homeScore,
              m.awayTeam,
              m.awayScore
            ]
          };
        });

        populateDivisionDropdown(allRows);
        renderScores(allRows);
      })
      .catch(err => {
        console.error("Failed to load JSON:", err);
        document.querySelector("#scoresTable tbody").innerHTML = "<tr><td colspan='3'>Unable to load data.</td></tr>";
      });
  }

  function filterDivision() {
    const selected = document.getElementById("divisionSelect").value;
    const filtered = selected === "all" ? allRows : allRows.filter(r => r.division === selected);
    renderScores(filtered);
  }

  function renderScores(rows) {
    const tbody = document.querySelector("#scoresTable tbody");
    tbody.innerHTML = "";

    rows.forEach(({ data }) => {
      const [date, meetName, team1, score1, team2, score2] = data;
      const s1 = score1 != null ? parseFloat(score1) : 0;
      const s2 = score2 != null ? parseFloat(score2) : 0;

      const team1IsWinner = s1 > s2;
      const team2IsWinner = s2 > s1;

      const team1Display = `<span class="${team1IsWinner ? 'winner' : ''}">
        ${team1}${team1IsWinner ? '<span class="check">✅</span>' : ''}
      </span>`;
      const team2Display = `<span class="${team2IsWinner ? 'winner' : ''}">
        ${team2}${team2IsWinner ? '<span class="check">✅</span>' : ''}
      </span>`;

      const scoreDisplay = `${team1Display} ${s1} — ${s2} ${team2Display}`;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${date}</td>
        <td class="meet-name">${meetName}</td>
        <td>${scoreDisplay}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  window.onload = function () {
    populateWeekDropdown();
    const latest = weekFiles[weekFiles.length - 1];
    document.getElementById("weekSelect").value = latest;
    loadWeekData(latest);
  };
</script>

</body>
</html>
