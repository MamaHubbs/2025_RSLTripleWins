<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>2025 RSL Meet Scores</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f8f8f8;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #0156B3;
      font-size: 2em;
      margin-bottom: 10px;
    }

    .dropdown-container {
      position: sticky;
      top: 0;
      background-color: #f8f8f8;
      padding: 10px;
      text-align: center;
      z-index: 10;
      border-bottom: 1px solid #ccc;
      font-size: 0.7em;
    }

    .dropdown-box {
      display: inline-block;
      margin: 0 4px;
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 6px;
    }

    select, input[type="text"] {
      padding: 3px 6px;
      font-size: 0.7em;
      border-radius: 4px;
    }

    button {
      padding: 4px 8px;
      font-size: 0.7em;
      border-radius: 4px;
      background-color: #0156B3;
      color: white;
      border: none;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.68em;
      margin-top: 10px;
    }

    th, td {
      padding: 6px 10px;
      border: 1px solid #ccc;
      text-align: left;
      vertical-align: top;
    }

    th {
      background-color: #e5f1ff;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    .row-group-even {
      background-color: #ffffff;
    }

    .row-group-odd {
      background-color: #f4f4f4;
    }

    .error {
      color: red;
      text-align: center;
      margin-top: 20px;
    }

    th:nth-child(1), td:nth-child(1) { max-width: 140px; }
    th:nth-child(2), td:nth-child(2) { max-width: 25px; text-align: center; }
    th:nth-child(3), td:nth-child(3) { max-width: 100px; }
    th:nth-child(4), td:nth-child(4) { max-width: 130px; }
    th:nth-child(5), td:nth-child(5) { max-width: 70px; text-align: center; }
    th:nth-child(6), td:nth-child(6) { max-width: 50px; }
    th:nth-child(7), td:nth-child(7) { max-width: 185px; }

    td {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .winner {
      font-weight: bold;
      color: green;
    }

    .check {
      font-size: 1em;
      margin-left: 4px;
    }

    .meet-name {
      font-style: italic;
      color: #666;
    }
  </style>
</head>
<body>

<h1>2025 RSL Meet Scores</h1>

<div class="dropdown-container">
  <div class="dropdown-box">
    <label for="weekSelect">Week</label>
    <select id="weekSelect" onchange="loadWeekData(this.value)">
      <!-- Dynamically populated -->
    </select>
  </div>
  <div class="dropdown-box">
    <label for="divisionSelect">Division</label>
    <select id="divisionSelect" onchange="filterDivision()">
      <option value="all">All Divisions</option>
    </select>
  </div>
</div>

<table id="scoresTable">
  <thead>
    <tr>
      <th>Date</th>
      <th>Meet</th>
      <th>Score</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const weekFiles = [
    "2025scoresweek01.json"
    // Add more weeks as needed
  ];

  const teamDivisionMap = {
    "Massad YMCA": "Battlefield",
    "Hampton Oaks": "Battlefield",
    "Woodlands": "Battlefield",
    "Fawn Lake": "Battlefield",
    "Spotswood": "Battlefield",
    "Curtis Park": "Battlefield",
    "Leeland Station": "Patriot",
    "Austin Ridge": "Patriot",
    "Lake of the Woods": "Patriot",
    "Lee's Hill": "Patriot",
    "Aquia Harbour": "Patriot",
    "Dahlgren": "Patriot",
    "Fox Point": "Patriot",
    "Fredericksburg CC": "American",
    "Ferry Farm": "American",
    "Chancellor": "American",
    "Hopyard": "American",
    "Caroline": "American",
    "Spotsy Y": "American",
    "Grafton": "National",
    "College Heights": "National",
    "Salem Fields": "National",
    "Lake Wilderness": "National",
    "Eden Estates": "National",
    "Idlewild": "National"
  };

  let allRows = [];

  function getDivision(team1, team2) {
    const d1 = teamDivisionMap[team1];
    const d2 = teamDivisionMap[team2];
    if (d1 && d2) {
      return d1 === d2 ? d1 : "Mixed";
    }
    return d1 || d2 || "Unknown";
  }

  function populateWeekDropdown() {
    const dropdown = document.getElementById("weekSelect");
    weekFiles.forEach((file, idx) => {
      const weekNum = idx + 1;
      const option = document.createElement("option");
      option.value = file;
      option.text = `Week #${weekNum}`;
      dropdown.appendChild(option);
    });
  }

  function loadWeekData(file) {
    fetch(file)
      .then(res => res.json())
      .then(data => {
        allRows = data.values.map(row => {
          const division = getDivision(row[2], row[4]);
          return { division, data: row };
        });
        populateDivisionDropdown(allRows);
        renderScores(allRows);
      })
      .catch(err => {
        console.error("Failed to load JSON:", err);
        document.querySelector("#scoresTable tbody").innerHTML = "<tr><td colspan='3'>Unable to load data.</td></tr>";
      });
  }

  function populateDivisionDropdown(rows) {
    const divisions = [...new Set(rows.map(row => row.division).filter(Boolean))];
    const divisionSelect = document.getElementById("divisionSelect");
    divisionSelect.innerHTML = `<option value="all">All Divisions</option>`;
    divisions.forEach(div => {
      const opt = document.createElement("option");
      opt.value = div;
      opt.text = div;
      divisionSelect.appendChild(opt);
    });
  }

  function filterDivision() {
    const selected = document.getElementById("divisionSelect").value;
    const filtered = selected === "all" ? allRows : allRows.filter(r => r.division === selected);
    renderScores(filtered);
  }

  function renderScores(rows) {
    const tbody = document.querySelector("#scoresTable tbody");
    tbody.innerHTML = "";

    rows.forEach(({ data }) => {
      const [date, meetName, team1, score1, team2, score2] = data;
      const s1 = parseFloat(score1) || 0;
      const s2 = parseFloat(score2) || 0;

      const team1IsWinner = s1 > s2;
      const team2IsWinner = s2 > s1;

      const team1Display = `<span class="${team1IsWinner ? 'winner' : ''}">
        ${team1}${team1IsWinner ? '<span class="check">✅</span>' : ''}
      </span>`;
      const team2Display = `<span class="${team2IsWinner ? 'winner' : ''}">
        ${team2}${team2IsWinner ? '<span class="check">✅</span>' : ''}
      </span>`;

      const scoreDisplay = `${team1Display} ${s1} — ${s2} ${team2Display}`;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${date}</td>
        <td class="meet-name">${meetName}</td>
        <td>${scoreDisplay}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  // On page load
  window.onload = function () {
    populateWeekDropdown();
    const latest = weekFiles[weekFiles.length - 1];
    document.getElementById("weekSelect").value = latest;
    loadWeekData(latest);
  };
</script>

</body>
</html>
